<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.tp.mes.app.prod.mapper.MaintenanceHistoryMapper">

    <resultMap id="HistoryResultMap" type="com.tp.mes.app.prod.model.MaintenanceHistory">
        <id property="historyId" column="history_id"/>
        <result property="equipmentId" column="equipment_id"/>
        <result property="maintenanceDate" column="maintenance_date"/>
        <result property="worker" column="worker"/>
        <result property="description" column="description"/>
        <result property="createdAt" column="created_at"/>
    </resultMap>

    <select id="findByEquipmentId" resultMap="HistoryResultMap">
        SELECT * FROM tp_maintenance_history
        WHERE equipment_id = #{equipmentId}
        ORDER BY maintenance_date DESC
    </select>

    <insert id="insert" parameterType="com.tp.mes.app.prod.model.MaintenanceHistory">
        <selectKey keyProperty="historyId" resultType="long" order="BEFORE">
            SELECT seq_maintenance_history_id.NEXTVAL FROM DUAL
        </selectKey>
        INSERT INTO tp_maintenance_history (
            history_id, equipment_id, maintenance_date, worker, description, created_at
        ) VALUES (
            #{historyId}, #{equipmentId}, #{maintenanceDate}, #{worker}, #{description}, CURRENT_TIMESTAMP
        )
    </insert>

</mapper>
